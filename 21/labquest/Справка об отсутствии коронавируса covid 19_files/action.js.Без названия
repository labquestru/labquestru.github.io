var ajax_send=!1,map=null;function setActiveOnFilterNews(){var t=$(".years-filter").find(".year-js").last();t.addClass("active").text(t.data("full"));var e=$(t.attr("href"));e.addClass("active"),$.each($(".month-filter"),(function(t,e){$(e).find("a").last().addClass("active")})),$(".novosti_list"+e.find(".month-js.active").attr("href")).addClass("active")}function initialize(){$(".address-list").mCustomScrollbar(),$("body").find(".map-canvas").each((function(){var t=parseInt($(this).parent().find(".map-canvas").attr("panByX")),e=parseInt($(this).parent().find(".map-canvas").attr("panByY")),s=parseInt($(this).parent().find(".map-canvas").attr("startx")),a=parseInt($(this).parent().find(".map-canvas").attr("starty")),i=parseInt($(this).parent().find(".map-canvas").attr("zoom"));if(i>0||(i=12),s>0&&a>0)var n=[$(this).parent().find(".map-canvas").attr("starty"),$(this).parent().find(".map-canvas").attr("startx")];else if($(this).parent().find("span").length>0)n=[$(this).parent().find("span:first").attr("y"),$(this).parent().find("span:first").attr("x")];else{n=[49.7690744,68.6894674];i=3}if(null==r){var r=new ymaps.Map(document.getElementById($(this).attr("id")),{center:n,zoom:i,maxZoom:18,controls:["zoomControl"]});$(window).width(),r.behaviors.disable("scrollZoom")}MyBalloonLayout=ymaps.templateLayoutFactory.createClass('<div class="si-wrapper-top si-has-border"><div class="si-shadow-wrapper-top"><div class="si-frame si-shadow-frame"></div><div class="si-shadow-pointer-top"><div class="si-shadow-inner-pointer-top"></div></div></div><div class="si-frame si-content-wrapper"><button type="button" class="si-close-button">×</button><div class="si-content">$[[options.contentLayout observeSize minWidth=452 maxWidth=452 maxHeight=275]]</div></div><div class="si-pointer-top si-pointer-border-top"></div><div class="si-pointer-top si-pointer-bg-top" style="border-width: 15px; margin-bottom: 0px; top: -1px;"></div></div>',{build:function(){this.constructor.superclass.build.call(this),this._$element=$(".si-wrapper-top",this.getParentElement()),this.applyElementOffset(),this._$element.find(".si-close-button").on("click",$.proxy(this.onCloseClick,this))},clear:function(){this._$element.find(".si-close-button").off("click"),this.constructor.superclass.clear.call(this)},onSublayoutSizeChange:function(){MyBalloonLayout.superclass.onSublayoutSizeChange.apply(this,arguments),this._isElement(this._$element)&&(this.applyElementOffset(),this.events.fire("shapechange"))},applyElementOffset:function(){},onCloseClick:function(t){t.preventDefault(),this.events.fire("userclose")},getShape:function(){if(!this._isElement(this._$element))return MyBalloonLayout.superclass.getShape.call(this);var t=this._$element.position();return new ymaps.shape.Rectangle(new ymaps.geometry.pixel.Rectangle([[t.left,t.top],[t.left+this._$element[0].offsetWidth,t.top+this._$element[0].offsetHeight+this._$element.find(".si-pointer-border-top")[0].offsetHeight]]))},_isElement:function(t){return t&&t[0]&&t.find(".si-pointer-border-top")[0]}}),MyBalloonContentLayout=ymaps.templateLayoutFactory.createClass("$[properties.balloonContent]"),t+e>0&&r.panTo([t,e]);var o=[],l=0;$(this).hasClass("map-canvas-new")?$(this).parent().find("span.span-item").each((function(t,e){var s=$(this).attr("name"),a=s;""!==s&&(s="<h4>"+s+"</h4>"),""!=$(this).attr("prem")&&(s+='<div class="prem"><img src="/local/images/icn_map_new_premium.svg" /></div>');var i=$(this).attr("metro");if(void 0!==i&&""!=i){var n=i.split(","),r=$(this).attr("color").split(",");i="",$.each(n,(function(t,e){i+='<div class="address-metro-link-new"><span class="metro" style="background-color: '+r[t]+'"></span><span class="text">м. '+e+"</span></div>"})),i='<div class="map-metros">'+i+"</div>"}var c=$(this).attr("adress");""!==c&&(c='<div class="map-location">'+i+c+"</div>");var d=$(this).attr("worktime");""!==d&&(d='<div class="map-worktime">'+d+"</div>");var p=$(this).attr("now");""!==p&&(p='<div class="wnow">'+p+"</div>");var h=$(this).attr("detail-url");""!==h&&(h=p+'<a class="gooffice" href="'+h+'">Перейти</a>'),o[l]={ele:String(l),name:s,title:a,detailUrl:h,x:$(this).attr("x"),y:$(this).attr("y"),adress:c,worktime:d,metro:i,icon:$(this).attr("icon")},l+=1})):$(this).parent().find("span").each((function(t,e){var s=$(this).attr("name"),a=s;""!==s&&(s="<h4>"+s+"</h4>");var i=$(this).attr("adress");""!==i&&(i='<div class="map-location">'+i+"</div>");var n=$(this).attr("worktime");""!==n&&(n='<div class="map-worktime">'+n+"</div>");var r=$(this).attr("metro");if(""!==r){var c=r.split(","),d=$(this).attr("color").split(",");r="",$.each(c,(function(t,e){r+='<div class="address-metro-link color-'+d[t]+'"><span class="dot"></span><span class="text">'+e+"</span></div>"})),r='<div class="map-metros">'+r+"</div>"}var p=$(this).attr("detail-url");""!==p&&(p='<a class="button button-icon button-gray js-show-location" href="'+p+'"><span>Как добраться</span><span class="ic"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 17 17"><path fill="#4e5b67" d="M9.9 14.28L8.79 8.14 2.46 7.08 15.3 1.66zM16.28.11L.96 6.61c-.55.23-.59.68-.08 1l7.07 1.46 1.35 7c.15.24.33.36.5.36.2 0 .38-.15.5-.44L16.85.69c.18-.42.08-.67-.21-.67-.1 0-.22.03-.36.09z"/></svg></span></a>'),o[l]={ele:String(l),name:s,title:a,detailUrl:p,x:$(this).attr("x"),y:$(this).attr("y"),adress:i,worktime:n,metro:r,icon:$(this).attr("icon")},l+=1}));var c=l,d=0,p=[];if(c>0){for(;d<c;){var h=[[o[d].ele,o[d].y,o[d].x]];p[d]=[[o[d].name+o[d].adress+o[d].worktime+o[d].detailUrl]];var f=o[d].name+o[d].adress+o[d].worktime+o[d].detailUrl;myPlacemark=new ymaps.Placemark([h[0][1],h[0][2]],{balloonHeader:o[d].name,balloonContent:f},{balloonShadow:!1,balloonLayout:MyBalloonLayout,balloonContentLayout:MyBalloonContentLayout,balloonPanelMaxMapArea:0,iconLayout:"default#image",iconImageHref:o[d].icon,iconImageSize:[34,47],iconImageOffset:[-5,-38],balloonOffset:[12,20]}),r.geoObjects.add(myPlacemark),d+=1}r.geoObjects.getBounds();r.setBounds(r.geoObjects.getBounds(),{checkZoomRange:!0}).then((function(){r.getZoom()>18&&r.setZoom(18)}))}}))}jQuery(document).ready((function(t){if(ymaps.ready(initialize),t(".hdr_search").on("click",(function(){if(t(".search-block-new").length>0)return t(this).toggleClass("hover"),t(".search-block-new").fadeToggle(300),!1})),t("body").on("click",".year-js",(function(e){var s=t(this),a=s.parent().find(".year-js.active");s.addClass("active").text(s.data("full")),a.removeClass("active").text("‘"+a.data("short"));var i=t(".month-filter"+s.attr("href"));return t(".month-filter.active").removeClass("active"),i.addClass("active"),t(".novosti_list").removeClass("active"),t(".novosti_list"+i.find(".month-js.active").attr("href")).addClass("active"),!1})),t("body").on("click",".month-js",(function(e){var s=t(this);return s.parent().find(".month-js.active").removeClass("active"),s.addClass("active"),t(".novosti_list").removeClass("active"),t(".novosti_list"+s.attr("href")).addClass("active"),!1})),setActiveOnFilterNews(),t("body").on("click",".grid-new p, .grid-add-new p",(function(e){t(this).parent().toggleClass("opend")})),t("body").on("click",".toggle_filters",(function(e){t(this).hasClass("act")?(t(this).find("span").text("Скрыть фильтры"),t(this).removeClass("act"),t(this).parent().find(".filter-form").slideDown()):(t(this).find("span").text("Показать фильтры"),t(this).addClass("act"),t(this).parent().find(".filter-form").slideUp())})),t("body").on("click",".offices-sort .clear_filters",(function(e){t(".offices-sort .checkbox input[type=checkbox]").prop("checked",!1);var s=t(this),a=s.parents(".offices-sort").find(".checkbox input[type=checkbox]:checked"),i=[];t.each(a,(function(e,s){i.push(t(s).data("value"))})),t(".offices-sort .clear_filters").hide(),t(".adresses-new").length>0?t.post("/include/ajax/get_adress_block_new.php",{filter:i,show_map:"true",type:t(".adresses-new").data("type")},(function(t){"true"===t.type&&s.parents(".adresses").find(".address-view-list").html(t.text_list),initialize()})):t.post("/include/ajax/get_adress_block.php",{filter:i,show_map:"true"},(function(t){if("true"===t.type){s.parents(".adresses").find("#list_address").before(t.text_list).remove();new Swiper(".address-lists",{nested:!0,autoHeight:!0,nextButton:".address-lists .swiper-button-next",prevButton:".address-lists .swiper-button-prev",pagination:".address-lists .swiper-pagination",paginationType:"fraction",observe:!0,observeParents:!0,paginationFractionRender:function(t,e,s){return'<span class="'+e+'"></span> <span class="spr"></span> <span class="'+s+'"></span>'}});s.parents(".adresses").find("#map_address").before(t.text_map).remove(),initialize()}}))})),t(document).on("click",".address-types a",(function(){t(this).parent().find("a").removeClass("act"),t(this).addClass("act");var e=t(this).data("type");return"list"==e?(t(".address-view-list").addClass("list-view"),t(".addr-left").show(),t(window).width()<1100&&t(".map-canvas-new").hide(),t(".address-view-metro").css("display","none")):"map"==e?(t(".address-view-list").removeClass("list-view"),t(window).width()<1100&&t(".addr-left").hide(),t(".map-canvas-new").show(),t(".address-view-metro").css("display","none")):"metro"==e&&(t(".address-view-list").removeClass("list-view"),t(window).width()<1100&&t(".addr-left").hide(),t(".map-canvas-new").hide(),t(".address-view-metro").css("display","inline-block")),!1})),t("body").on("change",".offices-sort .checkbox input[type=checkbox]",(function(e){var s=t(this),a=s.parents(".offices-sort").find('.checkbox input[type=checkbox][data-type="1"]:checked'),i=s.parents(".offices-sort").find('.checkbox input[type=checkbox][data-type="2"]:checked'),n=[],r=[];a.length>0&&t(".offices-sort .clear_filters").length>0?t(".offices-sort .clear_filters").show():t(".offices-sort .clear_filters").hide(),t.each(a,(function(e,s){n.push(t(s).data("value"))})),t.each(i,(function(e,s){r.push(t(s).data("value"))})),t(".adresses-new").length>0?t.post("/include/ajax/get_adress_block_new.php",{filter:n,filter2:r,show_map:"true",type:t(".adresses-new").data("type")},(function(e){"true"===e.type&&s.parents(".adresses").find(".address-view-list").html(e.text_list),initialize(),t(".address-types-new a").removeClass("act"),t('.address-types-new a[data-type="map"]').addClass("act")})):t.post("/include/ajax/get_adress_block.php",{filter:n,show_map:"true"},(function(t){if("true"===t.type){s.parents(".adresses").find("#list_address").before(t.text_list).remove();new Swiper(".address-lists",{nested:!0,autoHeight:!0,nextButton:".address-lists .swiper-button-next",prevButton:".address-lists .swiper-button-prev",pagination:".address-lists .swiper-pagination",paginationType:"fraction",observe:!0,observeParents:!0,paginationFractionRender:function(t,e,s){return'<span class="'+e+'"></span> <span class="spr"></span> <span class="'+s+'"></span>'}});s.parents(".adresses").find("#map_address").before(t.text_map).remove(),initialize()}}))})),t("body").on("click",".more-addr-js",(function(e){var s=t(this),a=t(s).parents("#list_address").find(".swiper-slide-active").find("ul"),i=t(s).parents("#list_address").find(".swiper-slide"),n="";return t.each(i,(function(e,s){n+=t(s).html(),t(s).hasClass("swiper-slide-active")||t(s).remove()})),a.parents(".address-lists").html(n),s.remove(),!1})),t("body").on("click",".add_cart-js",(function(e){e.preventDefault();var s=t(this),a={id:s.attr("data-id"),code:s.attr("data-code")};return t.post("/include/ajax/handle_cart.php",a,(function(e){"true"===e.type&&(s.toggleClass("active"),t(".count_cart-js").text(e.count))})),!1})),t.widget("app.autocomplete",t.ui.autocomplete,{options:{suggest:!1},_suggest:function(e){if(t.isFunction(this.options.suggest))return this.options.suggest(e);this._super(e)},_close:function(e){if(t.isFunction(this.options.suggest))return this.options.suggest([]),this._trigger("close",e);this._super(e)}}),t(".smart_search-js").autocomplete({delay:500,minLength:1,source:"/include/ajax/smart_search.php",select:function(t,e){window.location.href=e.item.url},focus:function(t,e){}}),t(".smart_search_all-js").autocomplete({delay:500,minLength:1,source:"/include/ajax/smart_search.php?all=Y",select:function(t,e){window.location.href=e.item.url},focus:function(t,e){}}),t(".smart_search_all-js-new").autocomplete({delay:500,minLength:1,source:"/include/ajax/smart_search.php?all=Y",select:function(t,e){window.location.href=e.item.url},suggest:function(e){var s=t(".search-block-new .results").empty();t.each(e,(function(){t("<a/>").attr("href",this.url).text(this.label).appendTo(s)}))},response:function(e,s){0==s.content.length?t(".search-block-new .allres").hide():t(".search-block-new .allres").show()}}).off("blur"),t(".smart_search_all-js-new-main").autocomplete({delay:500,minLength:1,source:"/include/ajax/smart_search.php?all=Y",select:function(t,e){window.location.href=e.item.url},suggest:function(e){var s=t(".search-main .results").empty();t.each(e,(function(){t("<a/>").attr("href",this.url).text(this.label).appendTo(s)}))},response:function(t,e){}}).off("blur"),t(document).on("click",(function(e){0!=t(e.target).closest(".result").length||t(e.target).hasClass("result")||t(".search-main .results").empty()})),t(".search-block-new .line .erase").on("click",(function(){return t(".search-block-new .results").empty(),t(".search-block-new .allres").hide(),t(".smart_search_all-js-new").val(""),t(".search-block-new").hide(),t(".hdr_search").removeClass("hover"),!1})),t(".hdr_top_not_main .main-nav .burg").on("click",(function(){t(this).hasClass("act")?(t(".hdr_top_not_main .main-nav .line2").fadeOut(300),t(this).removeClass("act")):(t(".hdr_top_not_main .main-nav .line2").fadeIn(300),t(this).addClass("act"))})),t(window).width()>1200);else{var e=0;t(".newadap-menu-wrap .item").each((function(){e=e+t(this).outerWidth()+25})),e+=50,t(".newadap-menu-wrap").width(e)}t(window).resize((function(){if(t(window).width()>1200);else{var e=0;t(".newadap-menu-wrap .item").each((function(){e=e+t(this).outerWidth()+25})),e+=50,t(".newadap-menu-wrap").width(e)}})),t("body").on("click",".print-js",(function(t){t.preventDefault(),window.print()})),t(".show_steps").click((function(e){e.preventDefault(),t(this).closest(".franchise-steps").toggleClass("steps_all"),"Узнать все этапы"===t(this).text()?t(this).text("Скрыть этапы"):t(this).text("Узнать все этапы")})),t("body").on("change","select[name=cityID]",(function(e){var s=t(this);s.next("input").remove(),"new"===s.val()&&s.after('<input type="text" name="cityName" placeholder="Введите название города">')})),t("body").on("submit",".importData",(function(e){var s=t(this),a=new FormData,i=s.find("input[name=data]")[0].files;if(0==i.length)return alert("Выберите файл для импорта"),!1;if(t.each(i,(function(t,e){a.append("file",e)})),a.append("iblock",s.find("select[name=iblock]").val()),"new"===s.find("select[name=cityID]").val()){if(""==s.find("input[name=cityName]").val().trim())return alert("Введите Название города"),!1;a.append("cityName",s.find("input[name=cityName]").val())}else a.append("cityID",s.find("select[name=cityID]").val());return ajax_send||(ajax_send=!0,s.find("button").text("Выполняется импорт данных, пожалуйста подождите").attr("disabled","true"),t.ajax({url:s.attr("action"),data:a,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(t){ajax_send=!1,"true"==t.type?s.html("<p>"+t.text+"</p>"):alert(t.text)}})),!1}))}));